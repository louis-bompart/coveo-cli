<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />

    <title>CLI: Diff viewer</title>

    <script src="node_modules/monaco-editor/min/vs/loader.js"></script>
    <!-- <script src="public/node_modules/monaco-editor/min/vs/loader.js"></script> -->
    <style>
      .editor-container {
        width: 1200px;
        height: 600px;
        border: 1px solid grey;
      }
    </style>
  </head>
  <body>
    <h2>Monaco Diff Editor Sample</h2>
    <div id="navbar"></div>
    <div id="container"></div>

    <script>
      require.config({
        paths: {vs: 'node_modules/monaco-editor/min/vs'},
        // paths: {vs: '/assets/monaco-editor/min/vs'},
      });

      require(['vs/editor/editor.main'], function () {
        function createNavBar() {
          // TODO:
        }

        function createNavivationButtons(diffEditor) {
          var container = document.getElementById('container');
          var navi = monaco.editor.createDiffNavigator(diffEditor, {
            followsCaret: true, // resets the navigator state when the user selects something in the editor
            ignoreCharChanges: true, // jump from line to line
          });
          window.setInterval(function () {
            navi.next();
          }, 2000);
        }

        function addNewEditorContainer() {
          const container = document.getElementById('container');
          const newEditorContainer = document.createElement('div');
          newEditorContainer.classList.add('editor-container');
          container.appendChild(newEditorContainer);
          return newEditorContainer;
        }

        function newEditor(originalTxt, modifiedTxt) {
          const editorContainer = addNewEditorContainer();
          // TODO: Link to NavBar
          var diffEditor = monaco.editor.createDiffEditor(editorContainer);
          diffEditor.setModel({
            original: monaco.editor.createModel(originalTxt, 'json'),
            modified: monaco.editor.createModel(modifiedTxt, 'json'),
          });
          createNavivationButtons(diffEditor);
        }

        fetch('/diff')
          .then((response) => response.json())
          .then((fileTuples) => {
            for (const {original, modified} of fileTuples) {
              console.log('new editor');
              newEditor(original, modified);
            }
          });
      });
    </script>
  </body>
</html>
